var YT_GetAccessToken=function(e,t,o,n){var i=new XMLHttpRequest;i.addEventListener("load",function(){"function"==typeof n&&n(e,t,JSON.parse(i.response).access_token)}),i.open("POST","https://www.googleapis.com/oauth2/v4/token"),i.setRequestHeader("Content-type","application/x-www-form-urlencoded");var a="client_id="+e+"&client_secret="+t+"&refresh_token="+o+"&grant_type=refresh_token";i.send(a)},YT_UploadVideo=function(e,t,o,n,i){if(void 0!=e){var a,d,r,s,l;"object"==typeof i&&(d=i.callback||"noop",r=i.progress||"noop",s=i.error||"noop",l=i.meta||{snippet:{title:"Atlex video",description:"Atlex",tags:["test"],categoryId:22},status:{privacyStatus:"unlisted"}});var p=new MediaUploader({baseUrl:"https://www.googleapis.com/upload/youtube/v3/videos",file:e,token:n,metadata:l,params:{part:"snippet,status"},onError:function(){document.getElementById("video-statustext").innerHTML="( Upload afbrudt pågrund af fejl )","function"==typeof s&&s()},onProgress:function(e){var t=(new Date).getTime()-a;"function"==typeof r&&r(e,t)},onComplete:function(e){var t=JSON.parse(e).id;document.getElementById("video-statustext").innerHTML="( Upload færdig )","function"==typeof d&&d(t)}});a=(new Date).getTime(),p.upload()}},YT_DeleteVideo=function(e,t,o,n,i){var a=new XMLHttpRequest;a.open("DELETE","https://www.googleapis.com/youtube/v3/videos"),"function"==typeof i&&a.addEventListener("load",i()),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.setRequestHeader("Authorization","Bearer "+n);var d="client_id="+t+"&client_secret="+o+"&scope=https://www.googleapis.com/auth/youtube&id="+e;a.send(d)},videoUploadBtn=document.getElementById("video-upload-btn");null!==videoUploadBtn&&videoUploadBtn.addEventListener("click",function(){$(".ovelse-form").find('input[name="video-id"]').length||YT_GetAccessToken("277088904091-9i70tiqg90t53ev4mu3j6dlfel4ie1h9.apps.googleusercontent.com","4DwvzFwbw4vVrrrxbO0w_rE_","1/XsKB2xh_rvd_ci2aRgIMjAOrgYImfr7x_SDpx_1w610",function(e,t,o){YT_UploadVideo(document.getElementById("video-file").files[0],e,t,o,{callback:function(e){$(".ovelse-form").prepend('<input type="hidden" name="video-id" value="'+e+'"/>'),$(".video-preview iframe").attr("src","https://youtube.com/embed/"+e),$(".video-upload").addClass("has-video")},progress:function(e,t){if(t/1e3>2.5){var o=Math.floor((e.total-e.loaded)/e.loaded*t),n=Math.floor(o/1e3/60)+" min "+Math.floor(o/1e3%60)+" sek";document.getElementById("video-statustext").innerHTML="( "+n+" )"}else document.getElementById("video-statustext").innerHTML="( Calculating estimated time remaining )"}})})}),$(".video-preview-delete").on("click",function(e){var t=$('input[name="video-id"]')[0].getAttribute("value");YT_GetAccessToken("277088904091-9i70tiqg90t53ev4mu3j6dlfel4ie1h9.apps.googleusercontent.com","4DwvzFwbw4vVrrrxbO0w_rE_","1/XsKB2xh_rvd_ci2aRgIMjAOrgYImfr7x_SDpx_1w610",function(e,o,n){YT_DeleteVideo(t,e,o,n,function(){})}),e.preventDefault(),$(".video-upload").removeClass("has-video"),$('input[name="video-id"]').remove();var o=$('input[name="post-id"]').val();"0"!==o&&$.ajax({url:ajaxURL,type:"POST",data:{action:"file_upload",delete:"video-id",post_id:o},dataType:"json",success:function(e){}})});
